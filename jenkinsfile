pipeline {
  agent any

  // Optional: Use this if you've installed NodeJS Plugin and configured 'Node 18'
  // tools {
  //   nodejs 'Node 18'
  // }

  environment {
    CI = 'true'
  }

  stages {
    stage('Checkout Code') {
      steps {
        git branch: 'master', url: 'https://github.com/HenryCode4/hill_cross.git'
      }
    }

    stage('Install Dependencies') {
      steps {
        bat 'npm install'
      }
    }

    stage('Install Playwright Browsers') {
      steps {
        bat 'npx playwright install --with-deps'
      }
    }

     stage('Start Dev Server') {
      steps {
        bat 'start /b npm run dev'
        // Sleep to give the server time to start
        bat 'timeout /t 10'
      }
    

    stage('Run Playwright Tests') {
      steps {
        bat 'npx playwright test'
      }
    }
  }

  post {
    success {
      emailext(
        subject: "✅ SUCCESS - ${env.JOB_NAME} #${env.BUILD_NUMBER}",
        body: "Build succeeded: ${env.BUILD_URL}",
        to: 'gabicebenjamin@yahoo.com'
      )
    }

    failure {
      emailext(
        subject: "❌ FAILED - ${env.JOB_NAME} #${env.BUILD_NUMBER}",
        body: "Build failed: ${env.BUILD_URL}",
        to: 'gabicebenjamin@yahoo.com'
      )
    }
  }
}
// This Jenkinsfile is designed to run Playwright tests in a CI/CD pipeline.
// It includes stages for checking out the code, installing dependencies, installing Playwright browsers, and running tests.

